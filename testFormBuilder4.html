<!DOCTYPE html>
<html lang="en">
    <head>

    <meta charset="utf-8">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <style type="text/css">
        * {
            padding:0;
            margin:0;
            font-size: 18 pt;
        }
        dl {
            margin-left: 75px;
            font-size: 18px;
        }
        dt {
            margin-left: 150px;
        }
        dd {
            margin-left: 200px;
        }
    </style>

        <title>
            Dynamically build FT survey
        </title>
        <script language="javascript">

            var chapObj = {};
            var globalChapCount = 0

            var createChap = function(chapName) {
                chapNameBasic = globalChapCount + chapName.replace(/\W/g, '').toLowerCase();
                chapObj[chapNameBasic] = new instChap(chapName);
                globalChapCount += 1;
            };

            var delChap = function(chapNameToDel) {
                delete chapObj[chapNameToDel];
            };

            var instChap = function(cName) {
                this.chapName = cName
                this.quesArray = {};
                var internalQuesCount = 0
                this.addQues = function(quesTextInput) {
                    quesTextInputBasic = internalQuesCount + quesTextInput.replace(/\W/g, '').toLowerCase();
                    this.quesArray[quesTextInputBasic] = {
                        quesText: quesTextInput,
                        ansArray: [],
                        addAns: function(ansText) { this.ansArray.push(ansText); },
                        delAns: function(index)   { this.ansArray.splice(index, 1); },
                    };
                    internalQuesCount += 1;
                };
                this.delQues = function(quesToDel) {
                    delete this.quesArray[quesToDel];
                }
            };

            var drawPage = function() {
                // clear existing content
                while (document.getElementById("starterSpan").firstChild) {
                    document.getElementById("starterSpan").removeChild(document.getElementById("starterSpan").firstChild)
                };

                // sort array by numeric indicator
                var sortable = [];
                for (var chapter in chapObj) {
                    sortable.push(chapter);
                };
                sortable.sort()

                // iterate through object via sorted keys
                for (var chapterTitle in sortable) {
                    // key for subsequent nested for loops
                    key = chapObj[sortable[chapterTitle]];
                    console.log();

                    // define input boxes and buttons for chapter level
                    var delChapButton = "<button type='button' style='width:120px' class='btn btn-default' onclick='runButton(delChap(" + '"' + sortable[chapterTitle] + '"' + "))'>Delete Chapter</button>";
                    var questionInputId = "chapter" + sortable[chapterTitle] + "question" + Object.keys(key.quesArray).length;
                    var addQuesInput = "<input type='text' style='width:200px' class='form-control' id='" + questionInputId + "' value='Enter question phrase.' onfocus='inputFocus(this)' onblur='inputBlur(this)'>";
                    var addQuesButton = "<button type='button' style='width:120px' class='btn btn-default' onclick='runButton(chapObj[" + '"' +  sortable[chapterTitle] + '"' + "].addQues(" + questionInputId + ".value))'>Add Ques.</button>";

                    // put text, buttons, and input boxes into dom
                    var ssChap = document.createElement("dl");
                        ssChap.id = key;
                        ssChap.innerHTML = key.chapName + " " + delChapButton + "<br>" + addQuesInput + " " + addQuesButton;
                    document.getElementById("starterSpan").appendChild(ssChap);
                    for (var ques in key.quesArray) {
                        // define input boxes and buttons for question level
                        var delQuesButton = "<button type='button' style='width:120px' class='btn btn-default' onclick='runButton(chapObj[" + '"' +  sortable[chapterTitle] + '"' + "].delQues(" + '"' +  ques + '"' + "))'>Delete Question</button>";
                        var answerInputId = "chapter" + sortable[chapterTitle] + "question" + Object.keys(key.quesArray).length + "answer" + Object.keys(key.quesArray).length;
                        var addAnswerInput = "<input type='text' style='width:200px' class='form-control' id='" + answerInputId + "' value='Enter answer phrase.' onfocus='inputFocus(this)' onblur='inputBlur(this)'>";
                        var addAnswerButton = "<button type='button' style='width:120px' class='btn btn-default' onclick='runButton(chapObj[" + '"' +  sortable[chapterTitle] + '"' + "].quesArray[" + '"' + ques + '"' + "].addAns(" + answerInputId + ".value))'>Add Answer</button>";

                        // put text, buttons, and input boxes into dom
                        var ssQues = document.createElement("dt");
                            ssQues.id = ques;
                            ssQues.innerHTML = key.quesArray[ques].quesText + " " + delQuesButton + "<br>" + addAnswerInput + " " + addAnswerButton;
                        document.getElementById("starterSpan").appendChild(ssQues);
                        for (var ans in key.quesArray[ques].ansArray) {
                            if(typeof(key.quesArray[ques].ansArray[ans]) != "undefined") {
                                // define delete answer box
                                var delAnsButton = "<button type='button' style='width:120px' class='btn btn-default' onclick='runButton(chapObj[" + '"' +  sortable[chapterTitle] + '"' + "].quesArray[" + '"' + ques + '"' + "].delAns(" + ans + "))'>Delete Answer</button>";

                                var ssAns = document.createElement("dd");
                                    ssAns.id = key.quesArray[ques].ansArray[ans].replace(/\s+/g, '_').toLowerCase();
                                    ssAns.innerHTML = key.quesArray[ques].ansArray[ans] + " " + delAnsButton
                                document.getElementById("starterSpan").appendChild(ssAns);
                            };
                        };
                    };
                }

                // add a new chapter at base
                var newChapInputBox = "<input type='text' style='width:225px' id='addChapInput' class='form-control' value='Enter new chapter name.' onfocus='inputFocus(this)' onblur='inputBlur(this)'>";
                var newChapInputButton = "<button type='button' style='width:120px' class='btn btn-default' onclick='runButton(createChap(document.getElementById(" + '"' + "addChapInput" + '"' + ").value))'>Add Chapter</button>";
                var newChapToAppend = document.createElement("dl");
                newChapToAppend.innerHTML = newChapInputBox + " " + newChapInputButton;
                document.getElementById("starterSpan").appendChild(newChapToAppend);
            };

            // operator to run task and auto-redraw
            var runButton = function(task) {
                task;
                drawPage();
            };

            // grey text for text box guidance
            function inputFocus(i){
                if(i.value==i.defaultValue){ i.value=""; i.style.color="#000"; }
            };
            function inputBlur(i){
                if(i.value==""){ i.value=i.defaultValue; i.style.color="#888"; }
            };
        </script>
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#">Flocktracker Survey Builder Tool</a>
                </div>
            </div>
        </div>

        <div id="container" style="padding-top: 100px">
            <dl id="starterSpan" class="form-group">
                <dd>
                    <input id="initChapName"  style="width:225px;" type="text" class="form-control" placeholder="Enter first chapter name."> <button onclick="runButton(createChap(document.getElementById('initChapName').value))" style="width:120px" class='btn btn-default' type="button">Start Building</button>
                </dd>
            </dl>

            <div style="margin-left: auto; margin-right: auto; width: 50%"><button onclick="console.log('pass')" class='btn btn-lg btn-success' type="button">Produce JSON</button></div>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>

    </body>
</html>