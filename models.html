	<!DOCTYPE html>
<html>
    <head>
    	<link href="css/bootstrap.min.css" rel="stylesheet">
        <title>
            Dynamically build FT survey
        </title>
    <style>
	    html, body {
	        height: 100%;
	        margin: 0px;	
	        padding: 0px;
	        text-align: left;
	    }
	    .project{
	    	left: 37%;
	    	position: relative;
      		overflow: hidden;
      		padding: 10px;
      		width: 60%;
      		min-width: 400px;
      		display: inline-block;
      		text-align: left;
	    }
      	.survey {
      		background: rgba(31, 61, 122, .2);
      		border-radius: 5px;
      		overflow: hidden;
      		padding: 10px;		
      	}
      	.tracker {
      		background: rgba(31, 61, 122, .2);
      		border-radius: 5px;
      		overflow: hidden;
      		padding: 10px;	
      	}      	
      	.chapter {
      		background: rgba(31, 61, 122, .2);
      		border-radius: 5px;
        	min-height: 100px;
      		margin: 10px;
	        padding: 10px
      	}	
      	.question{
      		background: rgba(31, 61, 122, .2);
      		border-radius: 5px;
      		margin: 10px;
	        padding: 10px
      	}
      	.questionsContainerDIV{
      		background: rgba(31, 61, 122, .2);
      		border-radius: 5px;
      		overflow: hidden;
      		padding: 10px
      	}
      	.chaptersContainerDIV{
      		background: rgba(31, 61, 122, .2);
      		border-radius: 5px;
      		overflow: hidden;
      		padding: 10px
      	}
      	.chapterContainerDIV{
      		background: rgba(31, 61, 122, .2);
      		border-radius: 5px;
      		margin: 2px;
	        padding: 2px;
	        position: relative;
	        width: 100%;
   			float: left;
      	}
      	.questionContainerDIV{
      		background: rgba(31, 61, 122, .2);
      		border-radius: 5px;
      		margin: 2px;
	        padding: 2px;
      	}
      	.answersContainerDIV{
      		background: rgba(31, 61, 122, .2);
      		border-radius: 5px;
      		overflow: hidden;
      		padding: 10px
      	}
      	.answerContainerDIV{
      		background: rgba(31, 61, 122, .2);
      		border-radius: 5px;
      		margin: 2px;
	        padding: 2px;
      	}
      	.jsonFloat{
      		position: fixed;
      		top: 60px;
      		background: rgba(31, 61, 122, .2);
      		padding: 20px;
      		text-align: left;
      		white-space: pre-wrap; 
      		width: 35%;
      		height: 100%;
      		overflow:hidden;
      		word-wrap: break-word
      	}
      	.floatHeader{
      		position: fixed;
      		height: 60px;
      		background: rgba(31, 61, 122, 1);
      		padding: 10px;
      		padding-left: 20px;
      		text-align: left;
      		white-space: pre-wrap; 
      		width: 35%;
      		overflow:hidden;
      		font-weight: 900;
      		font-size: 1.75em;
      		color: #FFFFFF;
      	}
    </style>
    <body>
    	<div id="project_container">
    		<div class="floatHeader">Flocktracker JSON Builder</div>
    		<div id="JsonGoesHere" class="jsonFloat"></div>
    		<div id="survey_container"></div>
    	</div>
  	</body>
    <script language="javascript">
    	var projectView = new projectView(new project());
    	var container = document.getElementById("project_container");
    	container.appendChild(projectView.getView());
    	// Here we put the ux elements
    	// Only constructors to apply the bootstrap classes and to change the format quickly.
    	function button(kind, nodeClass, text){
    		var button = document.createElement("button");;
    		if(kind == "add"){
    			button.className =  "btn btn-primary btn-sm" + " " + nodeClass;
    			button.innerHTML = '<span class="glyphicon glyphicon-plus"></span> ' + text;
    		} else if (kind == "remove"){
    			button.className =  "btn btn-danger btn-xs" + " " + nodeClass;
    			button.innerHTML = '<span class="glyphicon glyphicon-remove"></span> ' + text;
    		} else {
    			button.className =  "btn btn-default btn-sm"+ " " + nodeClass;
    			button.innerHTML = " " + text + "XX";
    		}
    		return button;
    	}
    	function select(kind, nodeClass, dropdownElementsArray){
    		this.kind = kind;
    		this.nodeClass = nodeClass;
    		this.dopdownElementsArray = dropdownElementsArray;
    		var select = document.createElement("select");
    		select.className = "form-control" + " " + nodeClass;
    		for (var i=0; i < dropdownElementsArray.length; i++){
    			option = document.createElement("option");
    			option.value = dropdownElementsArray[i];
    			option.innerHTML = dropdownElementsArray[i];
    			select.appendChild(option);
    		}
    		return select;
    	}

    	// Here be the Views
    	// !!/!T(&"#("/!(/T#")(/!=)/"=)(!)(YEU!")/H)"(UWE=")!"(!=)(!=#)(=))))
		function projectView(project){
			this.project = project;
			this.surveyView = new surveyView(new survey(), this);
			this.trackerView = new trackerView(new tracker(), this);
			var div = document.createElement('div');
			div.className = "project";
			div.appendChild(this.surveyView.getView());
			div.appendChild(this.trackerView.getView());
			var p = document.createElement("p")
			var floatDiv = document.getElementById('JsonGoesHere');
			var jsonText = document.createTextNode("jTxt");
			floatDiv.appendChild(jsonText)
			this.getView = function(){
				return div;
			};
			var contentChanges = 0;
			this.contentChanged = function(){
				var survey = this.surveyView.getSurvey();
				var tracker = this.trackerView.getTracker();
				project.setSurvey(survey);
				project.setTracker(tracker);
				contentChanges++;
				jsonText.nodeValue = "Change count: " + contentChanges + " Cut-and-paste this JSON: " + JSON.stringify(project.generateJSON());
			};
			this.contentChanged();
		}
		function surveyView(survey, parentView){
			this.survey = survey;
			var chapterViews = []; // Instances of chapters
			var div = document.createElement('div');
			div.className = "survey";
			var addChapterButton = new button("add", "", "Add chapter");
			var that = this;
			addChapterButton.onclick = function(){
            	that.addChapter(new chapter());
        	};
			var chaptersContainerDIV = document.createElement('div');
         	chaptersContainerDIV.className = "chaptersContainerDIV";
         	div.appendChild(chaptersContainerDIV);
         	div.appendChild(addChapterButton);
			this.getView = function(){
				return div;
			}
			this.addChapter = function(chapter){	
				var chapterContainerDIV = document.createElement('div');
         		chapterContainerDIV.className = "chapterContainerDIV";
				var newChapterView = new chapterView(chapter, this);
				chapterViews.push(newChapterView);
				var newChapterDIV = newChapterView.getView();
				var eraseChapterButton = new button("remove", "", "Erase chapter");
				var that = this;
				chapterContainerDIV.appendChild(eraseChapterButton);
				chapterContainerDIV.appendChild(newChapterDIV);
				chaptersContainerDIV.appendChild(chapterContainerDIV);
				eraseChapterButton.onclick = function(){
            		that.eraseChapter(chapterContainerDIV);
        		}
        		this.contentChanged();
			};
			this.eraseChapter = function(chapterDIV){
				var parentChilds = chapterDIV.parentNode.childNodes;
				for (var i=0; i < parentChilds.length; i++){
					if (parentChilds[i] == chapterDIV){
						chapterViews.splice(i,1);
						break
					}
				}
				chaptersContainerDIV.removeChild(chapterDIV);
				this.contentChanged();
			}
			this.contentChanged = function(){
				var changedChapters = [];
				for(i=0; i<chapterViews.length; i++){
					changedChapters[i] = chapterViews[i].getChapter();
				}
				survey.setChapters(changedChapters);
				parentView.contentChanged();
			};	
			this.getSurvey = function(){
				return survey;
			}
		}
		function questionArrayView(questionArray, parentView){
			var questionViews = []; //Array of question Views objects
			var div = document.createElement('div');
			div.className = "questionsContainerDIV";
			var questionsArrayContainer = document.createElement('div');
			questionsArrayContainer.className = "questionsArrayContainer";
			var addQuestionButton = new button("add", "", "Add question");
			var that = this;
			addQuestionButton.onclick = function(){
				that.addQuestion(new question());
         	}
         	div.appendChild(questionsArrayContainer);
         	div.appendChild(addQuestionButton);
			this.addQuestion = function(question){
				var questionContainerDIV = document.createElement('div');
         		questionContainerDIV.className = "questionContainerDIV";
				newQuestionView = new questionView(question, this, new questionKind());
				questionViews.push(newQuestionView);
				var newQuestionDIV = newQuestionView.getView();
				var eraseQuestionButton = new button("remove", "", "Erase question");
				var that = this;
				questionContainerDIV.appendChild(eraseQuestionButton);
				questionContainerDIV.appendChild(newQuestionDIV);
				questionsArrayContainer.appendChild(questionContainerDIV);
				eraseQuestionButton.onclick = function(){
            		that.eraseQuestion(questionContainerDIV);
            	}
            	this.contentChanged();
			}
			this.eraseQuestion = function(questionDIV){
				var parentChilds = questionDIV.parentNode.childNodes;
				for (var i=0; i < parentChilds.length; i++){
					if (parentChilds[i] == questionDIV){
						questionViews.splice(i,1);
						break
					}
				}
				questionsArrayContainer.removeChild(questionDIV);
				this.contentChanged();
			};
			this.contentChanged = function(){
				parentView.contentChanged();
			};	
			this.getView = function(){
				return div;
			}
			this.getQuestions = function(){
				var questions = [];
				for(i=0; i<questionViews.length; i++){
					questions[i] = questionViews[i].getQuestion();
				}
				return questions;
			}
		}

		function answerArrayView(questionArray, parentView){
			var answerViews = []; //Array of question Views objects
			var div = document.createElement('div');
			div.className = "answersContainerDIV";
			var answersArrayContainer = document.createElement('div');
			answersArrayContainer.className = "answersContainerDIV";
			var addAnswerButton = new button("add", "", "Add answer");
			var that = this;
			addAnswerButton.onclick = function(){
				that.addAnswer(new answer());
         	}
         	div.appendChild(answersArrayContainer);
         	div.appendChild(addAnswerButton);
			this.addAnswer = function(answer){
				var answerContainerDIV = document.createElement('div');
         		answerContainerDIV.className = "answerContainerDIV";
				newAnswerView = new answerView(answer, this);
				answerViews.push(newAnswerView);
				var newAnswerDIV = newAnswerView.getView();
				var eraseAnswerButton = new button("remove", "", "Erase answer");
				var that = this;
				answerContainerDIV.appendChild(eraseAnswerButton);
				answerContainerDIV.appendChild(newAnswerDIV);
				answersArrayContainer.appendChild(answerContainerDIV);
				eraseAnswerButton.onclick = function(){
            		that.eraseAnswer(answerContainerDIV);
            	}
            	this.contentChanged();
			}
			this.eraseAnswer = function(answerDIV){
				var parentChilds = answerDIV.parentNode.childNodes;
				for (var i=0; i < parentChilds.length; i++){
					if (parentChilds[i] == answerDIV){
						answerViews.splice(i,1);
						break
					}
				}
				answersArrayContainer.removeChild(answerDIV);
				this.contentChanged();
			};
			this.contentChanged = function(){
				parentView.contentChanged();
			};	
			this.getView = function(){
				return div;
			}
			this.getAnswers = function(){
				var answers = [];
				for(i=0; i<answerViews.length; i++){
					answers[i] = answerViews[i].getAnswer();
				}
				return answers;
			}
		}

		function answerView(answer, parentView) {
			this.answer = answer;
			this.parentView = parentView;
			//var questionKind = new questionKind();
			var div = document.createElement('div');
			div.className = "answer";
			var answerInput = document.createElement("input");
			answerInput.type = "text";
			answerInput.className = "form-control"
			var that = this;
			answerInput.oninput=function(){
				that.contentChanged();
			};
			var jumpInput = document.createElement("input");
			jumpInput.type = "text";
			jumpInput.className = "form-control"
			var that = this;
			jumpInput.oninput=function(){
				that.contentChanged();
			};
			div.appendChild(answerInput);
			div.appendChild(jumpInput);			
			this.getView = function(){
				return div;
			}
			this.contentChanged = function(){
				this.answer.setAnswerText(answerInput.value); 
				this.answer.setjumpID(jumpInput.value);	
				parentView.contentChanged();
			};
			this.getAnswer = function(){
				return answer;
			}
		};

		function chapterView(chapter, parentView) {
			this.chapter = chapter;
		  	var div = document.createElement('div');
			div.className = "chapter";
			var titleInput = document.createElement("input");
			titleInput.type = "text";
			titleInput.className = "form-control"
			var that = this;
			titleInput.oninput=function(){
				that.contentChanged();
			};
			div.appendChild(titleInput);
			this.questionArrayView = new questionArrayView(chapter.getQuestions(), this);
			div.appendChild(this.questionArrayView.getView());
			this.getView = function(){
				return div;
			}
			this.getChapter = function(){
				return chapter;
			}
			this.contentChanged = function(){
				this.chapter.setQuestions(this.questionArrayView.getQuestions());
				this.chapter.setTitle(titleInput.value); 
				parentView.contentChanged();
			};
		};
		function trackerView(tracker, parentView){
			this.tracker = tracker;
			var div = document.createElement('div');
			div.className = "tracker";
			this.questionArrayView = new questionArrayView(tracker.getQuestions(), this);
			div.appendChild(this.questionArrayView.getView());
			this.getView = function(){
				return div;
			}
			this.getTracker = function(){
				return tracker;
			}
			this.contentChanged = function(){
				this.tracker.setQuestions(this.questionArrayView.getQuestions());
				parentView.contentChanged();
			};
		}
		function questionView(question, parentView, questionKinds) {
			this.question = question;
			this.parentView = parentView;
			this.questionKinds = questionKinds;
			this.answerArrayView = null;
			this.questionArrayView = null;
			var div = document.createElement('div');
			div.className = "question";
			var that = this;
			var IDInput = document.createElement("input");
			IDInput.type = "text";
			IDInput.className = "form-control"
			IDInput.oninput=function(){
				that.contentChanged();
			};
			var questionInput = document.createElement("input");
			questionInput.type = "text";
			questionInput.className = "form-control"
			questionInput.oninput = function(){
				that.contentChanged();
			};

			var questionKindDropDown = new select("", "", this.questionKinds.getOptions());
			questionKindDropDown.onchange = function(){
				that.contentChanged();
			}

			var jumpInput = document.createElement("input");
			jumpInput.type = "text";
			jumpInput.className = "form-control"
			jumpInput.oninput=function(){
				that.contentChanged();
			};
			div.appendChild(IDInput);
			div.appendChild(questionInput);	
			div.appendChild(jumpInput);	
			div.appendChild(questionKindDropDown);	
			
			this.getView = function(){
				return div;
			}
			this.contentChanged = function(){
				this.question.setQuestionText(questionInput.value); 
				this.question.setQuestionID(IDInput.value);	
				this.question.setjumpID(jumpInput.value);
				this.updateQuestionKind(questionKindDropDown.options[questionKindDropDown.selectedIndex].value);
				if (this.answerArrayView != null){
					this.question.setAnswers(this.answerArrayView.getAnswers());
				} else{
					this.question.setAnswers(null);
				}
				this.question.setKind(questionKindDropDown.options[questionKindDropDown.selectedIndex].value);
				parentView.contentChanged();
			};
			this.getQuestion = function(){
				return question;
			}
			this.updateQuestionKind = function(newQuestionKind){
				switch(newQuestionKind){
					case this.questionKinds.OPEN_TEXT:
					case this.questionKinds.OPEN_NUMBER:
					case this.questionKinds.IMAGE:
						if (this.answerArrayView != null){
							div.removeChild(this.answerArrayView.getView());
							this.answerArrayView = null;
						}
						break;
					case this.questionKinds.MULTIPLE_CHOICE:
					case this.questionKinds.ORDERED:
					case this.questionKinds.CHECKBOX:
						if (this.answerArrayView == null){
							answers = this.question.getAnswers();
							this.answerArrayView = new answerArrayView(this.question.getAnswers(), this);
							div.appendChild(this.answerArrayView.getView());
						}
						break;
					case this.questionKinds.LOOP:
						if (this.questionArrayView == null){
							answers = this.question.getAnswers();
							this.answerArrayView = new answerArrayView(this.question.getAnswers(), this);
							div.appendChild(this.answerArrayView.getView());
						}
						break;	
				}
			}
		};

		///"&)(!/=)"!/=)/"!?/((/&(&%"!(&/=")/)"!(??"!)"=)?/")!=/!&"/!&?#&*)
		function answer() {
			var answerText = null; // String
			var jumpID = null; // String
			this.getAnswerText = function() {
				return answerText;
			};
			this.setAnswerText = function(answerText) {
				this.answerText = answerText;
			};
			this.getJumpID = function() {
				return this.jumpID;
			};
			this.setjumpID = function(jumpID) {
				this.jumpID = jumpID;
			};
			this.generateJSON = function(){  				
				var answerJSON = {};
  				answerJSON["Answer"] = this.answerText;
  				questionJSON["Jump"] = this.jumpID;
  				return answerJSON;
  			}
		};

		function question() {
			this.kind = null;
			this.loopQuestions = 	[]; // Question instances inside this question.
			this.questionText = null; // String
			this.answers = []; // Answer instances
			this.questionID = null; // String
			this.otherEnabled = null; // Boolean 
			this.jumpID = null; // String
			this.getKind = function() {
				return this.kind;
			};
			this.setKind = function(kind) {
				this.kind = kind;
			};
			this.getQuestionText = function() {
				return this.questionText;
			};
			this.setQuestionText = function(questionText) {
				this.questionText = questionText;
			};
			this.getAnswers = function() {
				return this.answers;
			};
			this.setAnswers = function(answers) {
				this.answers = answers;
			};
			this.getJumpID = function() {
				return this.jumpID;
			};
			this.setjumpID = function(jumpID) {
				this.jumpID = jumpID;
			};
			this.getQuestionID = function() {
				return questionID;
			};
			this.setQuestionID = function(questionID) {
				this.questionID = questionID;
			};
			this.isOtherEnabled = function() {
				return otherEnabled;
			};
			this.setOtherEnabled = function(otherEnabled) {
				this.otherEnabled = otherEnabled;
			};
			this.getLoopQuestions = function() {
				return loopQuestions;	
			};
			this.setLoopQuestions = function(loopQuestions) {
				this.loopQuestions = loopQuestions;
			};
			this.generateJSON = function(){  				
				var questionJSON = {};
  				questionJSON["Question"] = this.questionText;
  				questionJSON["id"] = this.questionID;
  				questionJSON["Kind"] = this.kind;
  				questionJSON["Other"] = this.otherEnabled;
  				questionJSON["Jump"] = this.jumpID;
  				questionJSON["Answers"] = this.answers;	
  				return questionJSON;
  			}
		};
		function questionKind(){
			this.MULTIPLE_CHOICE = "MC";
			this.OPEN_NUMBER = "ON";
			this.OPEN_TEXT = "OT";
			this.IMAGE = "IM";
			this.CHECKBOX = "CB";
			this.ORDERED = "OL";
			this.LOOP = "LP";
			this.getOptions = function(){
				var options = [];
				options.push(this.OPEN_TEXT);
				options.push(this.OPEN_NUMBER);				
				options.push(this.MULTIPLE_CHOICE);
				options.push(this.CHECKBOX);
				options.push(this.ORDERED);
				options.push(this.IMAGE);
				options.push(this.LOOP);
				return options;
			};
		};
		function chapter() {
		  	this.title = null; // String
		  	this.questions = []; //Array of question objects
		  	this.getTitle = function() {
		    	return title;
			};
			this.setTitle = function(title) {
				this.title = title;
			};
			this.getQuestions = function() {
				return this.questions;
			};
			this.setQuestions = function(questions) {
				this.questions = questions;
			};
			this.addQuestion = function(newQuestion){
				questions.push(newQuestion);
			}
			this.getQuestionCount = function() {
				if (questions == null){
					return 0
				} else {
					return questions.length;
				}
  			}
  			this.generateJSON = function(){
  				var chapterJSON = {};
				questionsJSONArray = [];
				for(var i=0; i < this.questions.length; i++){
					questionsJSONArray.push(this.questions[i].generateJSON());
				}
				chapterJSON["Chapter"] = this.title;
				chapterJSON["Questions"] = questionsJSONArray;
				return chapterJSON;
  			}
		};
		function survey(){
			this.chapters = []; // Instances of chapters
			this.fusionTableID = null; // String

			this.getfusionTableID= function() {
				return fusionTableID;
			};
			this.setfusionTableID = function(fusionTableID) {
				this.fusionTableID = fusionTableID;
			};
			this.getChapters = function() {
				return chapters;
			};
			this.setChapters = function(chapters) {
				this.chapters = chapters;
			};
			this.addChapter = function(newChapter){
				chapters.push(newChapter);3
			}
			this.getChapterCount = function() {
				if (chapters == null){
					return 0
				} else {
					return chapters.length;
				}
  			}
  			this.generateJSON = function(){
				var surveyJSON = {};
				var chaptersJSONArray = [];
				for(var i=0; i < this.chapters.length; i++){
					chaptersJSONArray.push(this.chapters[i].generateJSON());
				}
				surveyJSON["Chapters"] = chaptersJSONArray;
				surveyJSON["TableID"] = this.fusionTableID;
				return surveyJSON;
			}
		};
		function tracker(){
			this.questions = []; // Instances of questions
			this.fusionTableID = null; // String
			this.getfusionTableID = function() {
				return fusionTableID;
			};
			this.setfusionTableID = function(fusionTableID) {
				this.fusionTableID = fusionTableID;
			};
			this.getQuestions = function() {
			    return this.questions;
			};
			this.setQuestions = function(questions) {
				this.questions = questions;
			};
			this.generateJSON = function(){
				var trackerJSON = {};
				var questionsJSONArray = [];
				for(var i=0; i < this.questions.length; i++){
					questionsJSONArray.push(this.questions[i].generateJSON());
				}
				trackerJSON["Questions"] = questionsJSONArray;
				trackerJSON["TableID"] = this.fusionTableID;
				return trackerJSON;
			}
		};
		function project(){
			this.survey;
			this.tracker;
			this.getSurvey = function(){
				return survey;
			}
			this.setSurvey = function(survey){	
				this.survey = survey;
			}
			this.getTracker = function(){
				return tracker;
			}
			this.setTracker = function(tracker){
				this.tracker = tracker;
			}
			this.generateJSON = function(){
				var projectJSON = {};
				projectJSON["Survey"] = this.survey.generateJSON();
				projectJSON["Tracker"] = this.tracker.generateJSON();
				return projectJSON;
			}
		}
	</script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
</html>