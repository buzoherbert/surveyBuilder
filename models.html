	<!DOCTYPE html>
<html>
    <head>
    	<link href="css/bootstrap.min.css" rel="stylesheet">
        <title>
            Dynamically build FT survey
        </title>
    <style>
	    html, body {
	        height: 100%;
	        margin: 0px;
	        padding: 0px;
	        text-align: center;
	    }
	    .project{
	    	background-color: orange;
      		overflow: hidden;
      		padding: 10px;
      		width: 50%;
      		min-width: 400px;
      		display: inline-block;
      		text-align: left;
	    }
      	.survey {
      		background-color: pink;
      		overflow: hidden;
      		padding: 10px;		
      	}
      	.tracker {
      		background-color: white;
      		overflow: hidden;
      		padding: 10px;
      			
      	}      	
      	.chapter {
      		background-color: blue;
        	min-height: 100px;
      		margin: 10px;
	        padding: 10px
      	}	
      	.question{
      		background-color: green;
        	height: 80px;
      		margin: 10px;
	        padding: 10px
      	}
      	.questionsContainerDIV{
      		background-color: black;
      		overflow: hidden;
      		padding: 10px
      	}
      	.chaptersContainerDIV{
      		background-color: yellow;
      		overflow: hidden;
      		padding: 10px
      	}
      	.chapterContainerDIV{
      		background-color: green;
      		margin: 2px;
	        padding: 2px;
	        position: relative;
	        width: 100%;
   			float: left;
      	}
      	.questionContainerDIV{
      		background-color: red;
      		margin: 2px;
	        padding: 2px;
      	}
    </style>
    <body>
    	<div id="survey_container"></div>
  	</body>
    <script language="javascript">
    	var projectView = new projectView(new project());
    	document.getElementsByTagName('body')[0].appendChild(projectView.getView());
    	// Here we put the ux elements
    	// Only constructors to apply the bootstrap classes and to change the format quickly.
    	function button(kind, nodeClass, text){
    		var button = document.createElement("button");
    		if(kind == "add"){
    			button.className =  "btn btn-success" + " " + nodeClass;
    			button.innerHTML = '<span class="glyphicon glyphicon-plus"></span> ' + text;
    		} else if (kind == "remove"){
    			button.className =  "btn btn-danger" + " " + nodeClass;
    			button.innerHTML = '<span class="glyphicon glyphicon-remove"></span> ' + text;
    		} else {
    			button.className =  "btn btn-default"+ " " + nodeClass;
    			button.innerHTML = " " + text;
    		}
    		return button;
    	}

    	// Here be the Views
    	// !!/!T(&"#("/!(/T#")(/!=)/"=)(!)(YEU!")/H)"(UWE=")!"(!=)(!=#)(=))))
		function projectView(project){
			this.project = project;
			this.surveyView = new surveyView(new survey(), this);
			this.trackerView = new trackerView(new tracker(), this);
			var div = document.createElement('div');
			div.className = "project";
			div.appendChild(this.surveyView.getView());
			div.appendChild(this.trackerView.getView());
			var p = document.createElement("p")
			var jsonText = document.createTextNode("JsonGoesHere");
			div.appendChild(jsonText);
			this.getView = function(){
				return div;
			};
			var contentChanges = 0;
			this.contentChanged = function(){
				var survey = this.surveyView.getSurvey();
				var tracker = this.trackerView.getTracker();
				project.setSurvey(survey);
				project.setTracker(tracker);
				contentChanges++;
				jsonText.nodeValue = "Changes: " + contentChanges + " JSON: " + JSON.stringify(project.generateJSON());
			};
			this.contentChanged();
		}
		function surveyView(survey, parentView){
			this.survey = survey;
			var chapterViews = []; // Instances of chapters
			var div = document.createElement('div');
			div.className = "survey";
			var addChapterButton = new button("add", "", "Add chapter");
			var that = this;
			addChapterButton.onclick = function(){
            	that.addChapter(new chapter());
        	};
			div.appendChild(addChapterButton);
			var chaptersContainerDIV = document.createElement('div');
         	chaptersContainerDIV.className = "chaptersContainerDIV";
         	div.appendChild(chaptersContainerDIV);
			this.getView = function(){
				return div;
			}
			this.addChapter = function(chapter){	
				var chapterContainerDIV = document.createElement('div');
         		chapterContainerDIV.className = "chapterContainerDIV";
				var newChapterView = new chapterView(chapter, this);
				chapterViews.push(newChapterView);
				var newChapterDIV = newChapterView.getView();
				var eraseChapterButton = new button("remove", "", "Erase chapter");
				var that = this;
				chapterContainerDIV.appendChild(eraseChapterButton);
				chapterContainerDIV.appendChild(newChapterDIV);
				chaptersContainerDIV.appendChild(chapterContainerDIV);
				eraseChapterButton.onclick = function(){
            		that.eraseChapter(chapterContainerDIV);
        		}
        		this.contentChanged();
			};
			this.eraseChapter = function(chapterDIV){
				var parentChilds = chapterDIV.parentNode.childNodes;
				for (var i=0; i < parentChilds.length; i++){
					if (parentChilds[i] == chapterDIV){
						chapterViews.splice(i,1);
						break
					}
				}
				chaptersContainerDIV.removeChild(chapterDIV);
				this.contentChanged();
			}
			this.contentChanged = function(){
				var changedChapters = [];
				for(i=0; i<chapterViews.length; i++){
					changedChapters[i] = chapterViews[i].getChapter();
				}
				survey.setChapters(changedChapters);
				parentView.contentChanged();
			};	
			this.getSurvey = function(){
				return survey;
			}
		}
		function questionArrayView(questionArray, parentView){
			var questionViews = []; //Array of question Views objects
			var div = document.createElement('div');
			div.className = "questionsContainerDIV";
			var questionsArrayContainer = document.createElement('div');
			questionsArrayContainer.className = "questionsArrayContainer";
			var addQuestionButton = new button("add", "", "Add question");
			var that = this;
			addQuestionButton.onclick = function(){
				that.addQuestion(new question());
         	}
         	div.appendChild(addQuestionButton);
         	div.appendChild(questionsArrayContainer);
			this.addQuestion = function(question){
				var questionContainerDIV = document.createElement('div');
         		questionContainerDIV.className = "questionContainerDIV";
				newQuestionView = new questionView(question, this);
				questionViews.push(newQuestionView);
				var newQuestionDIV = newQuestionView.getView();
				var eraseQuestionButton = new button("remove", "", "Erase question");
				var that = this;
				questionContainerDIV.appendChild(eraseQuestionButton);
				questionContainerDIV.appendChild(newQuestionDIV);
				questionsArrayContainer.appendChild(questionContainerDIV);
				eraseQuestionButton.onclick = function(){
            		that.eraseQuestion(questionContainerDIV);
            	}
            	this.contentChanged();
			}
			this.eraseQuestion = function(questionDIV){
				var parentChilds = questionDIV.parentNode.childNodes;
				for (var i=0; i < parentChilds.length; i++){
					if (parentChilds[i] == questionDIV){
						questionViews.splice(i,1);
						break
					}
				}
				questionsArrayContainer.removeChild(questionDIV);
				this.contentChanged();
			};
			this.contentChanged = function(){
				parentView.contentChanged();
			};	
			this.getView = function(){
				return div;
			}
			this.getQuestions = function(){
				var questions = [];
				for(i=0; i<questionViews.length; i++){
					questions[i] = questionViews[i].getQuestion();
				}
				return questions;
			}
		}
		function chapterView(chapter, parentView) {
			this.chapter = chapter;
		  	var div = document.createElement('div');
			div.className = "chapter";
			var titleInput = document.createElement("input");
			titleInput.type = "text";
			var that = this;
			titleInput.oninput=function(){
				that.contentChanged();
			};
			div.appendChild(titleInput);
			this.questionArrayView = new questionArrayView(chapter.getQuestions(), this);
			div.appendChild(this.questionArrayView.getView());
			this.getView = function(){
				return div;
			}
			this.getChapter = function(){
				return chapter;
			}
			this.contentChanged = function(){
				this.chapter.setQuestions(this.questionArrayView.getQuestions());
				this.chapter.setTitle(titleInput.value); 
				parentView.contentChanged();
			};
		};
		function trackerView(tracker, parentView){
			this.tracker = tracker;
			var div = document.createElement('div');
			div.className = "tracker";
			this.questionArrayView = new questionArrayView(tracker.getQuestions(), this);
			div.appendChild(this.questionArrayView.getView());
			this.getView = function(){
				return div;
			}
			this.getTracker = function(){
				return tracker;
			}
			this.contentChanged = function(){
				this.tracker.setQuestions(this.questionArrayView.getQuestions());
				parentView.contentChanged();
			};
		}
		function questionView(question, parentView) {
			this.question = question;
			this.parentView = parentView;
			//var questionKind = new questionKind();
			var div = document.createElement('div');
			div.className = "question";
			var IDInput = document.createElement("input");
			IDInput.type = "text";
			var questionInput = document.createElement("input");
			questionInput.type = "text";
			div.appendChild(IDInput);
			div.appendChild(questionInput);			

			var questionKindDropDown = document.createElement("select");
			
			var op = new Option();
			op.value = 1;
			op.text = "First entry";
			questionKindDropDown.options.add(op);

  			questionKindDropDown.setAttribute('id',"year1")
  			questionKindDropDown.setAttribute('oncreate',"Date1()");
  			div.appendChild(questionKindDropDown);
			this.getView = function(){
				return div;
			}
			this.contentChanged = function(){
				parentView.contentChanged();
			}
			this.getQuestion = function(){
				return question;
			}
		};

		///"&)(!/=)"!/=)/"!?/((/&(&%"!(&/=")/)"!(??"!)"=)?/")!=/!&"/!&?#&*)
		function answer() {
			var answerText = null; // String
			var jumpID = null; // String
			this.getAnswerText = function() {
				return answerText;
			};
			this.setAnswerText = function(answerText) {
				this.answerText = answerText;
			};
			this.getJumpID = function() {
				return jumpID;
			};
			this.setjumpID = function(jumpID) {
				this.jumpID = jumpID;
			};
		};

		function question() {
			var kind = null;
			var loopQuestions = 	[]; // Question instances inside this question.
			var questionText = null; // String
			var answers = []; // Answer instances
			var questionID = null; // String
			var otherEnabled = null; // Boolean 
			var jumpID = null; // String
			this.getType = function() {
				return type;
			};
			this.setKind = function(kind) {
				this.kind = type;
			};
			this.getQuestionText = function() {
				return questionText;
			};
			this.setQuestionText = function(questionText) {
				this.questionText = questionText;
			};
			this.getAnswers = function() {
				return answers;
			};
			this.setAnswers = function(answers) {
				this.answers = answers;
			};
			this.getJumpID = function() {
				return jumpID;
			};
			this.setjumpID = function(jumpID) {
				this.jumpID = jumpID;
			};
			this.getQuestionID = function() {
				return questionID;
			};
			this.setQuestionID = function(questionID) {
				this.questionID = questionID;
			};
			this.isOtherEnabled = function() {
				return otherEnabled;
			};
			this.setOtherEnabled = function(otherEnabled) {
				this.otherEnabled = otherEnabled;
			};
			this.getLoopQuestions = function() {
				return loopQuestions;	
			};
			this.setLoopQuestions = function(loopQuestions) {
				this.loopQuestions = loopQuestions;
			};
			this.generateJSON = function(){  				
				questionJSON = {};
  				questionJSON["Question"] = questionText;
  				questionJSON["id"] = questionID;
  				questionJSON["Kind"] = kind;
  				questionJSON["Other"] = otherEnabled;
  				questionJSON["Jump"] = jumpID;
  				return questionJSON;
  			}
		};
		function questionKind(){
			var MULTIPLE_CHOICE = "MC";
			var OPEN_NUMBER = "ON";
			var OPEN_TEXT = "OT";
			var IMAGE = "IM";
			var CHECKBOX = "CB";
			var ORDERED = "OL";
			var LOOP = "LP";
		};
		function chapter() {
		  	this.title = null; // String
		  	this.questions = []; //Array of question objects
		  	this.getTitle = function() {
		    	return title;
			};
			this.setTitle = function(title) {
				this.title = title;
			};
			this.getQuestions = function() {
				return this.questions;
			};
			this.setQuestions = function(questions) {
				this.questions = questions;
			};
			this.addQuestion = function(newQuestion){
				questions.push(newQuestion);
			}
			this.getQuestionCount = function() {
				if (questions == null){
					return 0
				} else {
					return questions.length;
				}
  			}
  			this.generateJSON = function(){
  				var chapterJSON = {};
				questionsJSONArray = [];
				for(var i=0; i < this.questions.length; i++){
					questionsJSONArray.push(this.questions[i].generateJSON());
				}
				chapterJSON["Chapter"] = this.title;
				chapterJSON["Questions"] = questionsJSONArray;
				return chapterJSON;
  			}
		};
		function survey(){
			this.chapters = []; // Instances of chapters
			this.fusionTableID = null; // String

			this.getfusionTableID= function() {
				return fusionTableID;
			};
			this.setfusionTableID = function(fusionTableID) {
				this.fusionTableID = fusionTableID;
			};
			this.getChapters = function() {
				return chapters;
			};
			this.setChapters = function(chapters) {
				this.chapters = chapters;
			};
			this.getDIV = function(){
				return div;
			}
			this.addChapter = function(newChapter){
				chapters.push(newChapter);
			}
			this.getChapterCount = function() {
				if (chapters == null){
					return 0
				} else {
					return chapters.length;
				}
  			}
  			this.generateJSON = function(){
				var surveyJSON = {};
				var chaptersJSONArray = [];
				for(var i=0; i < this.chapters.length; i++){
					chaptersJSONArray.push(this.chapters[i].generateJSON());
				}
				surveyJSON["Chapters"] = chaptersJSONArray;
				surveyJSON["TableID"] = this.fusionTableID;
				return surveyJSON;
			}
		};
		function tracker(){
			this.questions = []; // Instances of questions
			this.fusionTableID = null; // String
			this.getfusionTableID = function() {
				return fusionTableID;
			};
			this.setfusionTableID = function(fusionTableID) {
				this.fusionTableID = fusionTableID;
			};
			this.getQuestions = function() {
			    return this.questions;
			};
			this.setQuestions = function(questions) {
				this.questions = questions;
			};
			this.generateJSON = function(){
				var trackerJSON = {};
				var questionsJSONArray = [];
				for(var i=0; i < this.questions.length; i++){
					questionsJSONArray.push(this.questions[i].generateJSON());
				}
				trackerJSON["Questions"] = questionsJSONArray;
				trackerJSON["TableID"] = this.fusionTableID;
				return trackerJSON;
			}
		};
		function project(){
			this.survey;
			this.tracker;
			this.getSurvey = function(){
				return survey;
			}
			this.setSurvey = function(survey){	
				this.survey = survey;
			}
			this.getTracker = function(){
				return tracker;
			}
			this.setTracker = function(tracker){
				this.tracker = tracker;
			}
			this.generateJSON = function(){
				var projectJSON = {};
				projectJSON["Survey"] = this.survey.generateJSON();
				projectJSON["Tracker"] = this.tracker.generateJSON();
				return projectJSON;
			}
		}
	</script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
</html>